---
title: "Introduction to zoocat package"
author: "Ran-ran He"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The zoocat package is a extension of the zoo package. The aim of the zoocat package is to provide a better manament of multidimensional time series. In zoo package, you can create a 2-dimension zoo object, in which each column stores a time series. You can use column names to store the information of each column.
The zoocat package give a another method to store the attributes of each column. For a zoocat object, a column attributes table is added to the object:

```{r,echo=FALSE}
library(zoocat)
```

# A simple case

```{r,echo=TRUE}
x <- matrix(1 : 20, nrow = 5)
colAttr <- data.frame(site = c('a', 'b', 'c', 'd'),
                      month = factor(c('Apr','May', 'Jun', 'Jul'),
                                     levels = c('Apr', 'May', 'Jun', 'Jul')))
print(colAttr)
zc <- zoocat(x, order.by = 1991 : 1995, colattr = colAttr)
print(zc)
```

So for constructing a zoocat object, a data frame of the column attributes table should be given. The struction of the zoocat object is quite simple:

```{r,echo=TRUE}
unclass(zc)
```

It can be seen that an attribute 'cattr' is added, in which there is the column attributes (cattr) table. Each row of the cattr table corresponding to a column of the core data.
The action of the zoocat object is similar with zoo object. When print, the column names will be added. You can use as.zoo to translate a zoocat object to be a real zoo object:

```{r,echo=TRUE}
zo <- as.zoo(zc)
print(zo)
```

Like zoo, you can get a subset of the object:
```{r,echo=TRUE}
zc[1 : 3, 2 : 4]
zc[3, 3]
zc['1994', ]
window(zc, start = 1993)
```

Like what can be done in reshapes package, you can melt the zoocat object:
```{r,echo=TRUE}
dfm <- melt(zc, index.name = 'year')
head(dfm)
```

You can also cast the melt data frame to be a zoocat object:
```{r,echo=TRUE}
zc.cast <- cast2zoocat(dfm, index.var = 'year', value.var = 'value')
print(zc.cast)
```

You can see that the zc.cast is the same with zc. If you want to get a time series whose index is month, you can cast dfm to another zoocat object:


# A example of SST data
 
```{r,echo=TRUE}
data(sst)
sstmelt <- melt(sst, id.var = c('year', 'month'))
zc <- cast2zoocat(sstmelt, index.var = 'year', value.var = 'value')
head(zc)
fuse <- function (x) {
    x <- window(x, start = 1980, end = 2014)
    ret <- c(max(x), min(x), mean(x), median(x), sd(x))
    names(ret) <- c('max', 'min', 'mean', 'median', 'sd')
    return(ret)
}
retdf <- colapply(zc, fun = fuse, col.as = 'zoo')
head(retdf)
```


# mlydata class

data(sst)
nino34 <- cast2mlydata(sst, index.var = 'year', 
                       value.var = 'nino34', month.var = 'month')
nino34 <- cbind(lag(nino34, -1), nino34, lag(nino34, 1))
nino34 <- na.trim(nino34)
nino34 <- normalize(nino34, mode = 'sd1')

nino34el <- nino34[c('1983', '1998', '2010'), ]
nino34el <- melt(nino34el)
library(lattice)
xyplot(value~month, group = year, data = nino34el, type = 'l')


nino34la <- nino34[c('1985', '2000', '2011'), ]
nino34la <- melt(nino34la)
xyplot(value~month, group = year, data = nino34la, type = 'l')


